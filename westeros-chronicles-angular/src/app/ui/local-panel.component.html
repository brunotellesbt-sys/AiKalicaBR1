<div class="panel">
  <div class="h2">Pessoas no local</div>
  <div class="p muted">Local: <b>{{state.locations[player.locationId]?.name}}</b></div>

  <div class="empty" *ngIf="charsHere().length===0">Não há personagens nomeados aqui neste momento.</div>

  <div class="card" *ngFor="let c of charsHere()">
    <div class="row">
      <div>
        <div class="name">{{displayNameWithSurname(c)}}</div>
        <div class="meta">
          {{houseName(c.currentHouseId)}} • {{c.gender==='M'?'Homem':'Mulher'}} • Idade: {{c.ageYears | number:'1.0-0'}} anos <span *ngIf="kinshipLabel(c)" class="muted">• {{kinshipLabel(c)}}</span>
        </div>
      </div>
      <div class="rel">Relação: <b>{{c.relationshipToPlayer}}</b>/100</div>
    </div>

    <div class="actions">
      <button (click)="on('talk', c.id)">Conversar</button>
      <button *ngIf="canDrinkWith(c)" (click)="on('drink', c.id)">Beber</button>
      <button *ngIf="canHuntWith(c)" (click)="on('hunt', c.id)" title="Caça em grupo masculino; mulheres só quando guerreiras.">Caçar</button>
      <button *ngIf="canFlowers(c)" (click)="on('flowers', c.id)" title="Flores apenas para mulheres.">Dar flores</button>
      <button *ngIf="canKiss(c)" (click)="on('kiss', c.id)" title="Requer relação 80+ e não pode com pai/mãe/filhos.">Beijar</button>
      <button *ngIf="canRelations(c)" (click)="on('relations', c.id)" title="Requer relação 90+ e beijo anterior.">Relações</button>
      <button *ngIf="canMarry(c)" (click)="onMarry(c)" title="Requer relação 92+ e beijo anterior. Se a mulher for a última da casa, você escolhe o sobrenome.">Casar</button>
    </div>
  </div>

  <!-- Modal simples de escolha de sobrenome (apenas quando a mulher é a última da casa) -->
  <div class="card" *ngIf="pendingMarriage">
    <div class="name">Escolha o sobrenome do casamento</div>
    <div class="meta">
      {{pendingMarriage.groomName}} + {{pendingMarriage.brideName}} • A noiva é a última viva da sua Casa.
    </div>
    <div class="p muted" style="margin-top:8px;">
      Pela regra padrão, o casal assume o sobrenome do homem. Você pode preservar a Casa da mulher.
    </div>
    <div class="actions" style="margin-top:10px;">
      <button (click)="confirmMarriage('patri')">Sobrenome do homem ({{pendingMarriage.groomHouse}})</button>
      <button (click)="confirmMarriage('matri')">Preservar a Casa da mulher ({{pendingMarriage.brideHouse}})</button>
      <button (click)="cancelMarriage()">Cancelar</button>
    </div>
  </div>
</div>
