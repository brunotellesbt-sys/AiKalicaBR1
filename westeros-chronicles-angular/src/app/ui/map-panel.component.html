<div class="wrap">
  <div class="head">
    <div class="title">Mapa de Westeros</div>
    <div class="sub">Clique em um reino no mapa e escolha um destino acessível</div>
  </div>

  <div class="body" *ngIf="state as s">
    <div class="where">
      Você está em <b>{{s.locations[s.characters[s.playerId].locationId].name}}</b>
      <span class="muted">({{s.regions[s.locations[s.characters[s.playerId].locationId].regionId]?.name}})</span>
    </div>

    <div class="map-toolbar">
      <button (click)="zoomOut()">−</button>
      <button (click)="resetZoom()">100%</button>
      <button (click)="zoomIn()">+</button>
      <span class="muted small">Zoom {{(zoom*100) | number:'1.0-0'}}%</span>
    </div>

    <div class="map-shell">
      <div class="map-image" [style.transform]="'scale(' + zoom + ')'">
        <img class="map-base" src="/assets/westeros-map.svg" alt="Mapa de Westeros" />
        <button
          *ngFor="let pin of regionPins"
          class="pin"
          [style.left.%]="pin.x"
          [style.top.%]="pin.y"
          [class.selected]="pin.id === selectedRegionId"
          [class.player-here]="isPlayerRegion(pin.id)"
          [title]="s.regions[pin.id]?.name"
          (click)="selectKingdom(pin.id)"
        >
          <span class="dot"></span>
          <span class="label">{{s.regions[pin.id]?.name}}</span>
        </button>
      </div>
    </div>

    <div class="card">
      <div class="h3">Reino selecionado</div>
      <div class="muted small" *ngIf="selectedRegionId">
        {{s.regions[selectedRegionId]?.name}} • Áreas disponíveis: {{areasInSelected().length}}
      </div>
      <div class="muted small" *ngIf="!selectedRegionId">Selecione um reino no mapa.</div>

      <div class="areas" *ngIf="selectedRegionId">
        <button
          *ngFor="let a of areasInSelected()"
          (click)="onGo(a.id)"
          [disabled]="a.disabled"
          [title]="a.hint"
        >
          {{a.label}}
        </button>
      </div>
    </div>

    <div class="card">
      <div class="h3">Destinos diretos (sua posição atual)</div>
      <div class="areas">
        <button *ngFor="let o of travelOptions()" (click)="onGo(o.id)">
          {{o.label}} <span class="muted">• {{o.hint}}</span>
        </button>
      </div>
    </div>
  </div>
</div>
